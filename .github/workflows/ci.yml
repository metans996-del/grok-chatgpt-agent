name: Agent CI

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  tests-and-linting:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install flake8 mypy bandit

          # üö® –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∏–ø–æ–≤ –¥–ª—è Mypy, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è requests.
          # GitHub Actions —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —á–∏—Å—Ç–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –≥–¥–µ —Ç–∏–ø—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.
          pip install types-requests
          
          # –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ requests —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç –≤ requirements.txt)
          pip install requests

      - name: Run tests
        # –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (–∫–æ—Ä–µ–Ω—å) –≤ PYTHONPATH.
        # –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ Python –Ω–∞–π–¥–µ—Ç –∏–º–ø–æ—Ä—Ç "from agent.agent_pr_proposer import..."
        run: |
          export PYTHONPATH=$PYTHONPATH:.
          pytest -q

      - name: Lint with flake8
        run: flake8 .

      - name: mypy type checking
        run: mypy .

      - name: Security check with Bandit
        run: bandit -r . -c bandit.yaml